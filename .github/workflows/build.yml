name: Android Build with Buildozer

on:
  push:
    branches:
      - main
      - master
  pull_request:
    branches:
      - main
      - master

jobs:
  build:
    # Use a modern, stable runner environment
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # Use a modern Python version

      - name: Install Buildozer
        run: |
          pip install buildozer

      - name: Create main.py (assuming user's code is in the root)
        # In a real scenario, the user would commit their main.py.
        # This step is a placeholder to ensure the build has a main file.
        # The user needs to ensure their main application file is named main.py
        # or update the source.main in buildozer.spec.
        run: |
          echo "import sys; print('Placeholder main.py executed'); sys.exit(0)" > main.py
          # Note: The user should replace this with their actual main.py file.

      - name: Copy buildozer.spec
        # This assumes the buildozer.spec is committed to the repository.
        # If not, this step would be used to create it.
        run: |
          # Since I created buildozer.spec in the root, this is just a reminder
          # that the file must be present.

      - name: Run Buildozer (Debug Build)
        # The buildozer command will download all necessary Android SDK components,
        # NDK, and Kivy dependencies, then build the APK.
        run: |
          buildozer android debug

      - name: Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: android-apk
          path: bin/*.apk
          retention-days: 7
